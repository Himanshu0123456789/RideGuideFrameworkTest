name: Build and Archive Framework

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: macOS-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v2

      - name: Set up Xcode
        uses: actions/setup-xcode@v2
        with:
          xcode-version: '13.0'

      - name: Install CocoaPods (if needed)
        run: |
          gem install cocoapods
          pod install

      - name: Build and Archive Framework
        run: |
          xcodebuild archive \
            -scheme RideGuideFramework \
            -destination="generic/platform=iOS Simulator" \
            -archivePath ./output/RideGuideFramework-Sim \
            SKIP_INSTALL=NO \
            BUILD_LIBRARY_FOR_DISTRIBUTION=YES
